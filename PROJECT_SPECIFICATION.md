# 美容メディアサイト - プロジェクト仕様書

## プロジェクト概要

### サイト名
**美活部** (Bikatsu-bu)

### 目的
美容に関する情報を発信する専門メディアサイト。コスメ情報、美容テクニック、イベント情報などを提供し、ユーザーの美容活動をサポートする。

### 対象ユーザー
- 美容に関心のある一般ユーザー
- コスメ・スキンケア製品の情報を求める人
- 美容の最新トレンドを知りたい人

---

## 技術仕様

### フロントエンド
- **Framework**: React.js with TypeScript
- **Styling**: TailwindCSS
- **Build Tool**: Next.js (予定)
- **状態管理**: React Hooks (useState, useEffect)

### バックエンド・データベース
- **Database**: Supabase (PostgreSQL)
- **認証**: Supabase Auth
- **画像ストレージ**: Cloudinary
- **API**: Supabase REST API

### インフラ・ホスティング
- **画像CDN**: Cloudinary (無料枠: 25GB/月)
- **データベース**: Supabase (無料枠利用)

---

## 機能仕様

### 1. ユーザー向け機能

#### 1.1 トップページ
- **レイアウト**: ヒーローセクション + コンテンツセクション
- **表示コンテンツ**:
  - Hot New Cosmetics (話題のコスメ) - 5記事
  - Beauty Topics (最新美容ニュース) - 6記事
  - Featured Events (注目の美容イベント) - 4記事
  - Professional's Column (プロの美容テクニック) - 3記事
  - Most Read Articles (人気記事ランキング) - 2記事
- **動的コンテンツ**: 管理画面から記事の選択・順序変更が可能

#### 1.2 記事閲覧機能
- **記事詳細表示**: タイトル、カテゴリ、公開日、アイキャッチ画像、本文
- **レイアウト**: メインコンテンツ(75%) + サイドバー(25%)
- **サイドバー機能**:
  - 最新の記事を読む (3記事)
  - 同じカテゴリーの記事を読む (3記事)
- **記事表示機能**:
  - Markdown記法サポート (見出し、リスト、画像、リンク、太字)
  - 表形式 (Markdownテーブル → HTMLテーブル変換)
  - 装飾囲い線 (情報、注意、ポイント、警告、引用)
  - 空行の適切な表示
  - レスポンシブ対応

#### 1.3 カテゴリページ
- **対応カテゴリ**:
  - シミ・くすみ
  - 毛穴
  - 赤み・赤ら顔
  - たるみ・しわ
  - ニキビ・ニキビ跡
- **表示**: カテゴリ別記事一覧 (カード形式)
- **記事カード**: 固定サイズ、タイトル、カテゴリ、日付、「続きを見る」

#### 1.4 その他機能
- **スキン診断**: 肌の悩み診断機能
- **ユーザー登録・ログイン**: 基本的な認証機能
- **マイページ**: ユーザー専用ページ

### 2. 管理者向け機能

#### 2.1 管理者認証
- **ログインシステム**: 管理者専用ログイン
- **セキュリティ**: Supabase Auth使用

#### 2.2 記事管理
- **記事作成・編集**:
  - タイトル、本文、メタディスクリプション、キーワード、スラッグ
  - カテゴリ選択
  - 記事タイプ (記事/コスメ)
  - ステータス (下書き/公開)
  - 画像アップロード (Cloudinary)
  - リアルタイムプレビュー
  - 装飾機能 (囲い線、タイトル付き装飾)

- **コスメ記事専用フィールド**:
  - ブランド名
  - 価格
  - 発売日
  - 評価 (1-5段階)

- **エディター機能**:
  - Markdownサポート
  - 装飾ツールバー (太字、見出し、リスト、画像挿入、装飾)
  - テキストエリア (35行表示)
  - 固定ヘッダー (スクロール時も操作可能)

- **画像管理**:
  - 記事内画像アップロード
  - アイキャッチ画像アップロード (1.91:1比率)
  - Cloudinary統合

- **プレビュー機能**:
  - リアルタイムプレビュー
  - 検索結果プレビュー (155文字制限)

#### 2.3 ページコンテンツ管理
- **セクション管理**: トップページの各セクションに表示する記事を選択
- **動的カード管理**: セクションごとにカード数の追加・削除
- **記事検索・フィルター**: タイトル・カテゴリでの記事検索
- **セクション構成**:
  1. Hot New Cosmetics
  2. Beauty Topics
  3. Featured Events
  4. Professional's Column
  5. Most Read Articles

#### 2.4 記事一覧・管理
- **記事リスト表示**: タイトル、カテゴリ、ステータス、公開日
- **操作機能**: 編集、削除、検索
- **参照整合性**: 使用中記事の安全な削除 (page_sections参照クリア)

---

## データベース構造

### articles テーブル
```sql
- id (UUID, Primary Key)
- title (文字列)
- content (テキスト)
- meta_description (文字列)
- keywords (文字列)
- slug (文字列, ユニーク)
- status (文字列: 'draft' | 'published')
- featured_image (文字列: URL)
- category (文字列)
- article_type (文字列: 'article' | 'cosmetic')
- brand (文字列, nullable)
- price (文字列, nullable)
- release_date (文字列, nullable)
- rating (数値, nullable)
- created_at (タイムスタンプ)
- updated_at (タイムスタンプ)
```

### page_sections テーブル
```sql
- id (UUID, Primary Key)
- section_name (文字列)
- position (数値)
- article_id (UUID, Foreign Key → articles.id)
- created_at (タイムスタンプ)
```

---

## ルーティング構造

### ユーザー向けページ
```
/ - トップページ
/article/{id} - 記事詳細
/category/{category} - カテゴリページ
/login - ユーザーログイン
/mypage - ユーザーマイページ
/skin-diagnosis - スキン診断
```

### 管理者向けページ
```
/admin - 管理者ログイン
/admin/dashboard - 管理ダッシュボード
/admin/articles/new - 新規記事作成
/admin/articles/edit/{id} - 記事編集
```

---

## UI/UX仕様

### デザインシステム
- **メインカラー**: #d11a68 (ピンク)
- **背景色**: #f3f4f6 (グレー)
- **テキスト**: #374151 (ダークグレー)
- **フォント**: システムフォント

### レスポンシブ対応
- **ブレークポイント**: TailwindCSS標準 (sm, md, lg, xl)
- **モバイルファースト**: 小さい画面から設計

### アクセシビリティ
- **キーボードナビゲーション**: 基本対応
- **カラーコントラスト**: WCAG 2.1 AA準拠
- **代替テキスト**: 画像のalt属性設定

---

## セキュリティ対策

### 認証・認可
- **管理者認証**: Supabase Auth
- **Row Level Security**: Supabase RLS有効化
- **セッション管理**: Supabase標準機能

### データ保護
- **SQLインジェクション対策**: Supabase ORM使用
- **XSS対策**: dangerouslySetInnerHTML最小限使用
- **CSRF対策**: Supabase標準機能

### 画像アップロード
- **ファイルタイプ制限**: 画像ファイルのみ
- **サイズ制限**: Cloudinary設定依存
- **アップロード先**: Cloudinary (外部サービス)

---

## パフォーマンス最適化

### 画像最適化
- **CDN配信**: Cloudinary CDN使用
- **自動最適化**: Cloudinary自動変換
- **アスペクト比**: 1.91:1 (アイキャッチ画像)

### データベース最適化
- **インデックス**: 主要カラムにインデックス設定
- **クエリ最適化**: 必要なデータのみ取得
- **キャッシュ**: ブラウザキャッシュ活用

---

## 運用・保守

### バックアップ
- **データベース**: Supabase自動バックアップ
- **画像**: Cloudinary冗長化

### 監視・ログ
- **エラー監視**: ブラウザコンソール
- **パフォーマンス**: 開発者ツール使用

### 更新・メンテナンス
- **記事更新**: 管理画面から随時更新可能
- **機能追加**: React Components追加で対応

---

## 今後の拡張予定

### 機能拡張
- [ ] コメント機能
- [ ] お気に入り機能
- [ ] 記事評価システム
- [ ] 検索機能 (全文検索)
- [ ] タグ機能
- [ ] RSS配信

### 技術的改善
- [ ] Next.js移行 (SSG/SSR対応)
- [ ] PWA対応
- [ ] 画像遅延読み込み
- [ ] SEO最適化強化

---

## 課題・制限事項

### 技術的制限
- **ルーティング**: SPAのため直接URL入力時の対応が限定的
- **SEO**: SSR未対応のため検索エンジン最適化が限定的
- **キャッシュ**: ブラウザキャッシュのみ

### 運用上の注意
- **Cloudinary制限**: 無料枠25GB/月の監視が必要
- **Supabase制限**: 無料枠の容量・リクエスト数制限
- **画像管理**: アップロード済み画像の一括管理機能なし

---

## 開発履歴

### 主要マイルストーン
1. **基本構造構築** - React + TailwindCSS + Supabase
2. **記事管理機能** - CRUD操作、エディター
3. **ページコンテンツ管理** - 動的コンテンツ管理
4. **装飾機能** - 記事内装飾、囲い線
5. **画像管理移行** - Supabase Storage → Cloudinary
6. **UI/UX改善** - サイドバー、テーブル表示、レスポンシブ対応

### 最終更新日
2025年1月17日

---

*この仕様書は開発の進行に合わせて随時更新されます。*